<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>guide - 50éŸ³æ¸¬é©—</title>

<style>
:root {
  font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans", Arial;
  background: #f6f7fb;
}
body { margin: 0; }

.header {
  background: white;
  border-bottom: 1px solid #e5e7eb;
  padding: 12px 16px;
}
.title { font-weight: 700; font-size: 18px; }

.main {
  max-width: 760px;
  margin: 0 auto;
  padding: 16px;
}

.card {
  background: white;
  border: 1px solid #e5e7eb;
  border-radius: 16px;
  padding: 14px;
  margin-top: 12px;
}

.row { display: flex; gap: 12px; flex-wrap: wrap; align-items: flex-end; }
.group { min-width: 170px; }
.label { font-size: 12px; color: #6b7280; margin-bottom: 6px; }

.seg { display: inline-flex; border: 1px solid #e5e7eb; border-radius: 12 160px; overflow: hidden; }
.seg button {
  border: 0;
  background: white;
  padding: 8px 10px;
  cursor: pointer;
}
.seg .active { background: #111827; color: white; }

.prompt {
  font-size: 56px;
  font-weight: 800;
  text-align: center;
  margin: 8px 0 4px;
}
.subprompt {
  text-align: center;
  color: #6b7280;
  margin-bottom: 6px;
  font-size: 14px;
}

.choices {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}

.choice {
  padding: 12px;
  border: 1px solid #e5e7eb;
  border-radius: 14px;
  background: white;
  font-size: 18px;
  cursor: pointer;
}

.correct { background: #ecfdf5; border-color: #16a34a; }
.wrong { background: #fef2f2; border-color: #dc2626; }

.actions { margin-top: 12px; display: flex; gap: 10px; flex-wrap: wrap; }
.primary, .ghost, .playBtn {
  padding: 10px 12px; border-radius: 12px;
  cursor: pointer; font-weight: 700;
  border: 1px solid #e5e7eb;
  background: white;
}
.primary { background: #111827; color: white; border-color: #111827; }
.playBtn { border-style: dashed; }
.ghost { color: #111827; }

.hint { margin-top: 10px; font-weight: 700; }
.small { font-size: 12px; color: #6b7280; font-weight: 500; }

.badge {
  display: inline-block;
  padding: 3px 8px;
  border-radius: 999px;
  border: 1px solid #e5e7eb;
  font-size: 12px;
  color: #374151;
  background: #fff;
}
</style>
</head>

<body>

<div class="header">
  <div class="title">guide â€“ 50éŸ³æ¸¬é©— <span class="badge">å«è½åŠ›æ¨¡å¼</span></div>
</div>

<div class="main">

<div class="card">
  <div class="row">

    <div class="group">
      <div class="label">æ–‡å­—ç³»çµ±</div>
      <div class="seg">
        <button id="hiraBtn" class="active">å¹³å‡å</button>
        <button id="kataBtn">ç‰‡å‡å</button>
      </div>
    </div>

    <div class="group">
      <div class="label">æ¨¡å¼</div>
      <div class="seg">
        <button id="k2rBtn" class="active">å‡åâ†’ç™¼éŸ³</button>
        <button id="r2kBtn">ç™¼éŸ³â†’å‡å</button>
        <button id="l2kBtn">è½åŠ›â†’å‡å</button>
      </div>
      <div class="small">è½åŠ›æ¨¡å¼æœƒç”¨ç€è¦½å™¨ TTS æ’­æ”¾</div>
    </div>

    <div class="group">
      <div class="label">åˆ†æ•¸</div>
      <div id="scoreBox">0 / 0</div>
    </div>

  </div>
</div>

<div class="card">
  <div id="prompt" class="prompt">ã‚</div>
  <div id="subprompt" class="subprompt"></div>

  <div id="choices" class="choices"></div>

  <div class="actions">
    <button id="playBtn" class="playBtn">ğŸ”Š æ’­æ”¾</button>
    <button id="nextBtn" class="primary">ä¸‹ä¸€é¡Œ</button>
    <button id="resetBtn" class="ghost">é‡ç½®åˆ†æ•¸</button>
  </div>

  <div id="hint" class="hint"></div>
</div>

</div>

<script>
// ====== 50éŸ³é¡Œåº« ======
const KANA = [
["ã‚","ã‚¢","a"],["ã„","ã‚¤","i"],["ã†","ã‚¦","u"],["ãˆ","ã‚¨","e"],["ãŠ","ã‚ª","o"],
["ã‹","ã‚«","ka"],["ã","ã‚­","ki"],["ã","ã‚¯","ku"],["ã‘","ã‚±","ke"],["ã“","ã‚³","ko"],
["ã•","ã‚µ","sa"],["ã—","ã‚·","shi"],["ã™","ã‚¹","su"],["ã›","ã‚»","se"],["ã","ã‚½","so"],
["ãŸ","ã‚¿","ta"],["ã¡","ãƒ","chi"],["ã¤","ãƒ„","tsu"],["ã¦","ãƒ†","te"],["ã¨","ãƒˆ","to"],
["ãª","ãƒŠ","na"],["ã«","ãƒ‹","ni"],["ã¬","ãƒŒ","nu"],["ã­","ãƒ","ne"],["ã®","ãƒ","no"],
["ã¯","ãƒ","ha"],["ã²","ãƒ’","hi"],["ãµ","ãƒ•","fu"],["ã¸","ãƒ˜","he"],["ã»","ãƒ›","ho"],
["ã¾","ãƒ","ma"],["ã¿","ãƒŸ","mi"],["ã‚€","ãƒ ","mu"],["ã‚","ãƒ¡","me"],["ã‚‚","ãƒ¢","mo"],
["ã‚„","ãƒ¤","ya"],["ã‚†","ãƒ¦","yu"],["ã‚ˆ","ãƒ¨","yo"],
["ã‚‰","ãƒ©","ra"],["ã‚Š","ãƒª","ri"],["ã‚‹","ãƒ«","ru"],["ã‚Œ","ãƒ¬","re"],["ã‚","ãƒ­","ro"],
["ã‚","ãƒ¯","wa"],["ã‚’","ãƒ²","wo"],
["ã‚“","ãƒ³","n"]
];

let script = "hira"; // hira | kata
let mode = "k2r";    // k2r | r2k | l2k
let current;
let correct;
let score = { c:0, t:0 };
let revealed = false;

// ===== å·¥å…· =====
function rand(n){ return Math.floor(Math.random()*n); }
function shuffle(a){ return a.sort(()=>Math.random()-0.5); }

function kanaLabel(item){
  return script==="hira" ? item[0] : item[1];
}

// ===== TTSï¼ˆè½åŠ›æ’­æ”¾ï¼‰=====
function speakJP(text){
  if(!("speechSynthesis" in window)) {
    alert("æ­¤ç€è¦½å™¨ä¸æ”¯æ´ SpeechSynthesisã€‚å»ºè­°ç”¨ Chrome / Edgeã€‚");
    return;
  }

  // åœæ‰ä¸Šä¸€å¥ï¼ˆé¿å…é€£æ’­ç–Šåœ¨ä¸€èµ·ï¼‰
  window.speechSynthesis.cancel();

  const u = new SpeechSynthesisUtterance(text);
  u.lang = "ja-JP";
  u.rate = 0.9;   // ç¨æ…¢ä¸€é»æ¯”è¼ƒåƒå­¸ç¿’
  u.pitch = 1.0;

  // å˜—è©¦æŒ‘æ—¥æ–‡ voiceï¼ˆå„ç€è¦½å™¨ voice åç¨±ä¸åŒï¼‰
  const voices = window.speechSynthesis.getVoices?.() || [];
  const jp = voices.find(v => (v.lang || "").toLowerCase().startsWith("ja"));
  if(jp) u.voice = jp;

  window.speechSynthesis.speak(u);
}

// æŸäº›ç€è¦½å™¨è¦å…ˆè¼‰å…¥ voices
if("speechSynthesis" in window){
  window.speechSynthesis.onvoiceschanged = () => {};
}

// ===== å‡ºé¡Œ =====
function newQuestion(){
  revealed = false;
  document.getElementById("hint").textContent = "";

  current = KANA[rand(KANA.length)];
  const [h,k,r] = current;

  // é¡¯ç¤ºå€ï¼ˆprompt/subpromptï¼‰
  const promptEl = document.getElementById("prompt");
  const subEl = document.getElementById("subprompt");

  if(mode==="k2r"){
    promptEl.textContent = kanaLabel(current);
    subEl.textContent = "è«‹é¸æ“‡æ­£ç¢ºçš„ romaji ç™¼éŸ³";
    correct = r;

    let opts=[r];
    while(opts.length<4){
      const rr = KANA[rand(KANA.length)][2];
      if(!opts.includes(rr)) opts.push(rr);
    }
    renderChoices(shuffle(opts), "romaji");

  } else if(mode==="r2k"){
    promptEl.textContent = r;
    subEl.textContent = "è«‹é¸æ“‡æ­£ç¢ºçš„å‡å";
    correct = kanaLabel(current);

    let opts=[correct];
    while(opts.length<4){
      const kk = script==="hira"
        ? KANA[rand(KANA.length)][0]
        : KANA[rand(KANA.length)][1];
      if(!opts.includes(kk)) opts.push(kk);
    }
    renderChoices(shuffle(opts), "kana");

  } else { // l2k è½åŠ›â†’å‡å
    promptEl.textContent = "ğŸ”Š";
    subEl.textContent = "æŒ‰æ’­æ”¾è½ç™¼éŸ³ï¼Œé¸å‡ºæ­£ç¢ºå‡åï¼ˆå¯é‡æ’­ï¼‰";
    correct = kanaLabel(current);

    let opts=[correct];
    while(opts.length<4){
      const kk = script==="hira"
        ? KANA[rand(KANA.length)][0]
        : KANA[rand(KANA.length)][1];
      if(!opts.includes(kk)) opts.push(kk);
    }
    renderChoices(shuffle(opts), "kana");

    // è‡ªå‹•æ’­æ”¾ä¸€æ¬¡ï¼ˆå¦‚æœè¢«ç€è¦½å™¨æ“‹æ‰ä¹Ÿæ²’é—œä¿‚ï¼Œä»å¯æ‰‹å‹•æŒ‰æ’­æ”¾ï¼‰
    setTimeout(()=> speakJP(r), 80);
  }
}

// ===== ç•«é¸é … =====
function renderChoices(arr, kind){
  const box=document.getElementById("choices");
  box.innerHTML="";

  arr.forEach(v=>{
    const b=document.createElement("button");
    b.className="choice";
    b.textContent=v;

    b.onclick=()=>{
      if(revealed) return;
      revealed=true;

      score.t++;
      if(v===correct){
        score.c++;
        b.classList.add("correct");
      }else{
        b.classList.add("wrong");
      }

      updateScore();

      document.getElementById("hint").textContent =
        `æ­£è§£ï¼š${correct}ï¼ˆ${current[0]} / ${current[1]} = ${current[2]}ï¼‰`;
    };

    box.appendChild(b);
  });
}

function updateScore(){
  document.getElementById("scoreBox").textContent = `${score.c} / ${score.t}`;
}

// ===== ä»‹é¢äº‹ä»¶ =====
const hiraBtn = document.getElementById("hiraBtn");
const kataBtn = document.getElementById("kataBtn");
const k2rBtn  = document.getElementById("k2rBtn");
const r2kBtn  = document.getElementById("r2kBtn");
const l2kBtn  = document.getElementById("l2kBtn");

hiraBtn.onclick=()=>{
  script="hira";
  hiraBtn.classList.add("active");
  kataBtn.classList.remove("active");
  newQuestion();
};

kataBtn.onclick=()=>{
  script="kata";
  kataBtn.classList.add("active");
  hiraBtn.classList.remove("active");
  newQuestion();
};

k2rBtn.onclick=()=>{
  mode="k2r";
  k2rBtn.classList.add("active");
  r2kBtn.classList.remove("active");
  l2kBtn.classList.remove("active");
  newQuestion();
};

r2kBtn.onclick=()=>{
  mode="r2k";
  r2kBtn.classList.add("active");
  k2rBtn.classList.remove("active");
  l2kBtn.classList.remove("active");
  newQuestion();
};

l2kBtn.onclick=()=>{
  mode="l2k";
  l2kBtn.classList.add("active");
  k2rBtn.classList.remove("active");
  r2kBtn.classList.remove("active");
  newQuestion();
};

document.getElementById("nextBtn").onclick=()=>newQuestion();

document.getElementById("resetBtn").onclick=()=>{
  score={c:0,t:0};
  updateScore();
  newQuestion();
};

document.getElementById("playBtn").onclick=()=>{
  // è½åŠ›æ¨¡å¼ï¼šæ’­æ”¾ romajiï¼ˆæ›´åƒç™¼éŸ³é¡Œï¼‰
  // å…¶ä»–æ¨¡å¼ï¼šä¹Ÿè®“ä½ å¯ä»¥æŒ‰æ’­æ”¾ï¼ˆåŠ åˆ†åŠŸèƒ½ï¼‰
  const r = current?.[2] || "a";
  speakJP(r);
};

// ===== å•Ÿå‹• =====
updateScore();
newQuestion();
</script>

</body>
</html>
